<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>git-Ladder</title>
    <style>
        /* Theme Variables */
        :root {
            --gh-bg: #ffffff;
            --gh-header: #24292f;
            --gh-border: #d0d7de;
            --gh-green: #238636;
            --gh-red: #cf222e;
            --gh-blue: #0969da;
            --tile-light: #ffffff;
            --tile-dark: #f6f8fa;
            --text-main: #24292f;
            --card-bg: #ffffff;
            --sidebar-header: #f6f8fa;
        }

        [data-theme="dark"] {
            --gh-bg: #0d1117;
            --gh-header: #161b22;
            --gh-border: #30363d;
            --gh-green: #3fb950;
            --gh-red: #f85149;
            --gh-blue: #58a6ff;
            --tile-light: #161b22;
            --tile-dark: #0d1117;
            --text-main: #c9d1d9;
            --card-bg: #161b22;
            --sidebar-header: #21262d;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
            margin: 0;
            background-color: var(--gh-bg);
            color: var(--text-main);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            transition: background-color 0.3s ease;
        }

        header {
            background: var(--gh-header);
            color: white;
            padding: 12px 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid var(--gh-border);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .repo-title { font-weight: 600; font-size: 14px; }
        .repo-title span { opacity: 0.5; font-weight: 400; }

        .theme-toggle {
            background: transparent;
            border: 1px solid #444;
            color: white;
            padding: 6px 10px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 11px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .main-container {
            display: grid;
            grid-template-columns: 1fr 320px;
            gap: 20px;
            max-width: 1200px;
            margin: 15px auto;
            padding: 0 15px;
            box-sizing: border-box;
            width: 100%;
        }

        .board-container { 
            position: relative; 
            width: 100%; 
            /* Board will be as wide as container allows */
            max-width: 700px; 
            margin: 0 auto;
        }

        .board {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            grid-template-rows: repeat(10, 1fr);
            border: 1px solid var(--gh-border);
            border-radius: 4px;
            width: 100%;
            aspect-ratio: 1 / 1;
            position: relative;
            z-index: 1;
            background: var(--gh-border); /* Grid line color */
            gap: 1px; /* Creates clean grid lines */
            overflow: hidden;
        }

        #game-canvas {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            z-index: 2;
        }

        .tile {
            background-color: var(--tile-light);
            display: flex;
            flex-direction: column;
            padding: 10%;
            /* Font scales with the board size */
            font-size: clamp(7px, 2.2vw, 12px); 
            font-weight: bold;
            color: #8c959f;
            position: relative;
        }

        .tile-dark { background-color: var(--tile-dark); }
        .pr-ladder-tile { background-color: rgba(63, 185, 80, 0.1); color: var(--gh-green); }
        .conflict-snake-tile { background-color: rgba(248, 81, 73, 0.1); color: var(--gh-red); }

        .player {
            width: 6.5%; 
            height: 6.5%; 
            border-radius: 4px; 
            position: absolute;
            transition: left 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275), top 0.4s ease;
            z-index: 10; 
            border: 1.5px solid white; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            pointer-events: none;
        }
        #p1 { background-color: var(--gh-blue); }
        #p2 { background-color: #bf3989; }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .card {
            border: 1px solid var(--gh-border);
            border-radius: 6px;
            background: var(--card-bg);
        }

        .card-header {
            background: var(--sidebar-header);
            padding: 10px 15px;
            border-bottom: 1px solid var(--gh-border);
            font-size: 13px;
            font-weight: 600;
        }

        .card-body { padding: 15px; }

        .btn {
            width: 100%; padding: 12px; background: var(--gh-green); color: white;
            border: 1px solid rgba(27,31,36,0.15); border-radius: 6px;
            font-weight: 600; cursor: pointer; font-size: 14px;
        }
        .btn:active { opacity: 0.8; transform: translateY(1px); }

        .log {
            font-family: ui-monospace, SFMono-Regular, monospace;
            font-size: 11px; height: 150px;
            overflow-y: auto; padding: 10px; background: var(--tile-dark);
            color: var(--text-main);
        }

        .log-entry { border-bottom: 1px solid var(--gh-border); padding: 5px 0; opacity: 0.8; }

        /* Mobile Optimization */
        @media (max-width: 850px) {
            .main-container { 
                grid-template-columns: 1fr; 
                margin: 0;
                padding: 10px;
                gap: 15px;
            }
            .board-container {
                max-width: 100%; /* Use full screen width */
            }
            .sidebar {
                display: grid;
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body data-theme="light">

<header>
    <div class="repo-title">git-ladder <span>/</span> <b>snake-n-ladder</b></div>
    <button class="theme-toggle" onclick="toggleTheme()">
        <span id="theme-icon">ðŸŒ™</span> Dark Mode
    </button>
</header>

<div class="main-container">
    <div class="board-area">
        <div class="board-container">
            <div id="game-board" class="board"></div>
            <svg id="game-canvas"></svg>
            <div id="p1" class="player"></div>
            <div id="p2" class="player"></div>
        </div>
    </div>

    <div class="sidebar">
        <div class="card">
            <div class="card-header">Terminal / Deploy Control</div>
            <div class="card-body">
                <div id="turn-display" style="margin-bottom: 12px; font-weight: bold; color: var(--gh-blue);">Player 1 (Blue) to Roll</div>
                <button id="roll-btn" class="btn" onclick="playTurn()">Roll Dice</button>
                <div id="dice-result" style="margin-top: 12px; font-size: 28px; text-align: center;">ðŸŽ² -</div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">Deployment Logs</div>
            <div id="game-log" class="log">
                <div class="log-entry">> Initializing repository...</div>
            </div>
        </div>
    </div>
</div>

<script>
    const ladders = { 4: 25, 13: 46, 33: 49, 42: 63, 50: 69, 62: 81, 74: 92 };
    const snakes = { 27: 5, 40: 3, 43: 18, 54: 31, 66: 45, 89: 53, 95: 77, 99: 41 };
    let p1Pos = 1, p2Pos = 1, currentTurn = 1;

    function toggleTheme() {
        const body = document.body;
        const icon = document.getElementById('theme-icon');
        const isLight = body.getAttribute('data-theme') === 'light';
        body.setAttribute('data-theme', isLight ? 'dark' : 'light');
        icon.innerText = isLight ? 'â˜€ï¸' : 'ðŸŒ™';
        drawConnectors();
    }

    function createBoard() {
        const board = document.getElementById('game-board');
        board.innerHTML = '';
        for (let r = 9; r >= 0; r--) {
            for (let c = 0; c < 10; c++) {
                let tileNum = (r % 2 === 0) ? (r * 10) + (c + 1) : (r * 10) + (10 - c);
                const tile = document.createElement('div');
                tile.className = `tile ${(r + c) % 2 !== 0 ? 'tile-dark' : ''}`;
                
                if (ladders[tileNum]) {
                    tile.classList.add('pr-ladder-tile');
                    tile.innerHTML = `<span>${tileNum}</span><div style="font-size:0.7em; margin-top:2px;">â†‘ PR</div>`;
                } else if (snakes[tileNum]) {
                    tile.classList.add('conflict-snake-tile');
                    tile.innerHTML = `<span>${tileNum}</span><div style="font-size:0.7em; margin-top:2px;">â†“ ERR</div>`;
                } else {
                    tile.innerHTML = `<span>${tileNum}</span>`;
                }
                board.appendChild(tile);
            }
        }
    }

    function drawConnectors() {
        const svg = document.getElementById('game-canvas');
        const board = document.getElementById('game-board');
        svg.innerHTML = ''; 
        const isDark = document.body.getAttribute('data-theme') === 'dark';
        const tileSize = board.offsetWidth / 10;

        const getCenter = (pos) => {
            const row = Math.floor((pos - 1) / 10);
            const col = (pos - 1) % 10;
            const xCol = (row % 2 === 0) ? col : 9 - col;
            const yRow = 9 - row;
            return { x: xCol * tileSize + tileSize / 2, y: yRow * tileSize + tileSize / 2 };
        };

        for (let start in ladders) {
            const p1 = getCenter(start), p2 = getCenter(ladders[start]);
            const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
            line.setAttribute("x1", p1.x); line.setAttribute("y1", p1.y);
            line.setAttribute("x2", p2.x); line.setAttribute("y2", p2.y);
            line.setAttribute("stroke", isDark ? "#3fb95099" : "#23863666");
            line.setAttribute("stroke-width", tileSize/8); line.setAttribute("stroke-dasharray", "5,3");
            svg.appendChild(line);
        }

        for (let start in snakes) {
            const p1 = getCenter(start), p2 = getCenter(snakes[start]);
            const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
            const midX = (p1.x + p2.x) / 2 + (tileSize/2);
            path.setAttribute("d", `M ${p1.x} ${p1.y} Q ${midX} ${(p1.y+p2.y)/2} ${p2.x} ${p2.y}`);
            path.setAttribute("stroke", isDark ? "#f8514999" : "#cf222e66");
            path.setAttribute("stroke-width", tileSize/8); path.setAttribute("fill", "transparent");
            svg.appendChild(path);
        }
    }

    function updatePlayerPositions() {
        const board = document.getElementById('game-board');
        const tileSize = board.offsetWidth / 10;

        [1, 2].forEach(pNum => {
            const pos = pNum === 1 ? p1Pos : p2Pos;
            const row = Math.floor((pos - 1) / 10);
            const col = (pos - 1) % 10;
            const xCol = (row % 2 === 0) ? col : 9 - col;
            const yRow = 9 - row;
            
            const offset = pNum === 1 ? tileSize * 0.1 : tileSize * 0.35;
            const pElem = document.getElementById(`p${pNum}`);
            pElem.style.left = (xCol * tileSize + offset) + "px";
            pElem.style.top = (yRow * tileSize + tileSize * 0.2) + "px";
        });
        drawConnectors();
    }

    async function playTurn() {
        const btn = document.getElementById('roll-btn');
        btn.disabled = true;
        const dice = Math.floor(Math.random() * 6) + 1;
        document.getElementById('dice-result').innerText = "ðŸŽ² " + dice;
        
        let pos = currentTurn === 1 ? p1Pos : p2Pos;
        logMsg(`Player ${currentTurn} rolled ${dice}`);

        for (let i = 0; i < dice; i++) {
            if (pos < 100) pos++;
            if (currentTurn === 1) p1Pos = pos; else p2Pos = pos;
            updatePlayerPositions();
            await new Promise(r => setTimeout(r, 200));
        }

        if (ladders[pos]) {
            logMsg(`[SUCCESS] PR Merged!`);
            pos = ladders[pos];
        } else if (snakes[pos]) {
            logMsg(`[ERROR] Build Failed!`);
            pos = snakes[pos];
        }

        if (currentTurn === 1) p1Pos = pos; else p2Pos = pos;
        updatePlayerPositions();

        if (pos === 100) {
            alert(`Player ${currentTurn} deployed to Production!`);
            location.reload();
        }

        currentTurn = currentTurn === 1 ? 2 : 1;
        const display = document.getElementById('turn-display');
        display.innerText = `Player ${currentTurn} to Roll`;
        display.style.color = currentTurn === 1 ? 'var(--gh-blue)' : '#bf3989';
        btn.disabled = false;
    }

    function logMsg(msg) {
        const log = document.getElementById('game-log');
        const entry = document.createElement('div');
        entry.className = 'log-entry'; entry.innerText = "> " + msg;
        log.prepend(entry);
    }

    window.onload = () => { createBoard(); setTimeout(updatePlayerPositions, 100); };
    window.addEventListener('resize', updatePlayerPositions);
</script>
</body>
</html>
